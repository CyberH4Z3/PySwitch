<!DOCTYPE html>
<html>
<link>
    <meta charset="utf-8">
    <title>Generate metadata buffers</title>
    
    <script type="text/javascript" src="../lib/pyodide/pyodide.js"></script>
    <script type="text/javascript" src="../test/lib/FileSaver/FileSaver.min.js"></script>

    <script src="../js/PySwitchRunner.js"></script>
    <script src="../js/misc/Tools.js"></script>
    <script src="../js/model/parsers/FunctionExtractor.js"></script>


    <script type="text/javascript">
        function download(data, fileName) {
            const dataString = JSON.stringify(data);
            const dataBlob = new Blob([dataString], {type: 'text/plain'});
            const url = URL.createObjectURL(dataBlob);

            window.saveAs(url, fileName);
        }

        window.onload = async function() {
            const pyswitch = new PySwitchRunner(
                {
                    domNamespace: "pyswitch",
                    updateIntervalMillis: 10
                }, 
                "test-pyswitch"
            );

            await pyswitch.init("../");

            const extractor = new FunctionExtractor(pyswitch);
        
            const actions = await extractor.get({
                tocPath: "../circuitpy/lib/pyswitch/clients/toc.php",
                subPath: "kemper/actions",
                targetPath: "pyswitch/clients/kemper/actions"
            });

            download(actions, "actions.json");

            const mappings = await extractor.get({
                tocPath: "../circuitpy/lib/pyswitch/clients/toc.php",
                subPath: "kemper/mappings",
                targetPath: "pyswitch/clients/kemper/mappings"
            });

            download(mappings, "mappings.json");

        }
    </script>
</script>
<body>

</body>
</link>
